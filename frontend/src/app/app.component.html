<div class="container py-4">
  <h1 class="mb-1">{{ titulo }}</h1>
  <p class="text-muted mb-4">Backend: Spring Boot · Banco: PostgreSQL</p>

  <form class="row g-3 align-items-end" [formGroup]="form" (ngSubmit)="converter()">
    <div class="col-sm-3">
      <label class="form-label">De</label>
      <select class="form-select" formControlName="co_moeda_origem" (change)="carregarCotacoes()">
        <option *ngFor="let m of moedas" [value]="m.co_moeda">
          {{ m.co_moeda }} — {{ m.no_moeda }}
        </option>
      </select>
    </div>

    <div class="col-sm-1 d-grid">
      <button type="button" class="btn btn-outline-secondary mt-4" (click)="inverter()">⇅</button>
    </div>

    <div class="col-sm-3">
      <label class="form-label">Para</label>
      <select class="form-select" formControlName="co_moeda_destino">
        <option *ngFor="let m of moedas" [value]="m.co_moeda">
          {{ m.co_moeda }} — {{ m.no_moeda }}
        </option>
      </select>
    </div>

    <div class="col-sm-3">
      <label class="form-label">Valor</label>
      <input type="number" class="form-control" formControlName="vl_montante" step="0.01" min="0" />
    </div>

    <div class="col-sm-2 d-grid">
      <button class="btn btn-primary" [disabled]="carregando || form.invalid" type="submit">
        {{ carregando ? 'Convertendo...' : 'Converter' }}
      </button>
    </div>
  </form>

  <div class="mt-3" *ngIf="erro">
    <div class="alert alert-danger">{{ erro }}</div>
  </div>

  <div class="mt-4" *ngIf="resultado">
    <h4>Resultado</h4>
    <p class="lead mb-0">
      {{ resultado?.vl_montante | number:'1.2-6' }} {{ resultado?.co_moeda_origem }}
      =
      <strong>{{ resultado?.vl_resultado | number:'1.2-6' }}</strong> {{ resultado?.co_moeda_destino }}
    </p>
    <small class="text-muted">
      Taxa: 1 {{ resultado?.co_moeda_origem }} = {{ resultado?.vl_taxa | number:'1.4-8' }} {{ resultado?.co_moeda_destino }}
    </small>
  </div>

  <div class="row mt-4">
    <div class="col-lg-6">
      <h5>Últimas cotações (base: {{ form.value.co_moeda_origem }})</h5>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Moeda</th>
              <th>Taxa</th>
              <th>Data Ref.</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let c of cotacoes">
              <td>{{ c.co_moeda_cotada }}</td>
              <td>{{ c.vl_taxa | number:'1.4-8' }}</td>
              <td>{{ c.dt_referencia | date:'mediumDate' }}</td>
            </tr>
            <tr *ngIf="!cotacoes?.length">
              <td colspan="3" class="text-muted">Sem dados.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="d-flex justify-content-between align-items-center">
        <h5>Histórico (últimas 10)</h5>
        <button class="btn btn-sm btn-outline-danger" (click)="limparHistorico()">Limpar</button>
      </div>
      <ul class="list-group">
        <li *ngFor="let h of historico" class="list-group-item d-flex justify-content-between">
          <span>
            {{ h.vl_montante | number:'1.2-6' }} {{ h.co_moeda_origem }}
            →
            <strong>{{ h.vl_resultado | number:'1.2-6' }} {{ h.co_moeda_destino }}</strong>
            <small class="text-muted ms-2">taxa {{ h.vl_taxa | number:'1.4-8' }}</small>
          </span>
          <small class="text-muted">{{ h.dt | date:'short' }}</small>
        </li>
        <li *ngIf="!historico.length" class="list-group-item text-muted">Sem histórico.</li>
      </ul>
    </div>
  </div>
</div>
