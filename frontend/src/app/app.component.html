<div class="container my-4">
  <h1 class="display-5 fw-semibold mb-4">{{ titulo }}</h1>

  <!-- CARD DO FORM -->
  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <form class="row g-3 align-items-end" [formGroup]="form" (ngSubmit)="converter()">

        <div class="col-lg-2 col-md-3">
          <label class="form-label">Valor</label>
          <input type="number" class="form-control" formControlName="vl_montante" step="0.01" min="0">
        </div>

        <div class="col-lg-3 col-md-4">
          <label class="form-label">Converter de</label>
          <select class="form-select" formControlName="co_moeda_origem" (change)="carregarCotacoes()">
            <option *ngFor="let m of moedas" [value]="m.co_moeda">
              {{ m.no_moeda }} ({{ m.co_moeda }})
            </option>
          </select>
        </div>

        <div class="col-md-1 d-grid">
          <button type="button" class="btn btn-teal mt-4" title="Inverter" (click)="inverter()">
            <i class="bi bi-arrow-left-right"></i>
          </button>
        </div>

        <div class="col-lg-3 col-md-4">
          <label class="form-label">Para</label>
          <select class="form-select" formControlName="co_moeda_destino">
            <option *ngFor="let m of moedas" [value]="m.co_moeda">
              {{ m.no_moeda }} ({{ m.co_moeda }})
            </option>
          </select>
        </div>

        <div class="col-lg-2 col-md-3">
          <label class="form-label">Data da cotação</label>
          <input class="form-control" type="date" formControlName="dt_referencia">
        </div>

        <div class="col-md-1 d-grid">
          <button type="button" class="btn btn-teal mt-4" title="Atualizar cotações" (click)="atualizar()">
            <i class="bi bi-arrow-repeat"></i>
          </button>
        </div>

        <div class="col-12 text-end">
          <button class="btn btn-primary" [disabled]="carregando || form.invalid" type="submit">
            {{ carregando ? 'Convertendo...' : 'Converter' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- RESULTADO -->
  <div class="card shadow-sm">
    <div class="card-header bg-light fw-semibold">Resultado da conversão</div>
    <div class="card-body">

      <div class="row g-3">
        <div class="col-lg-6">
          <div class="p-3 rounded border bg-light">
            <div class="fw-semibold mb-2">Conversão de:</div>
            <div>
              {{ moedaOrigem?.no_moeda }}/{{ moedaOrigem?.co_moeda }}
              ({{ moedaOrigem?.nu_codigo_numerico }})
            </div>
            <div class="mt-2">
              <span class="fw-semibold">Valor a converter:</span>
              {{ form.value.vl_montante | number:'1.2-6' }}
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="p-3 rounded border bg-light">
            <div><span class="fw-semibold">Para:</span>
              {{ moedaDestino?.no_moeda }}/{{ moedaDestino?.co_moeda }}
              ({{ moedaDestino?.nu_codigo_numerico }})
            </div>
            <div class="mt-2">
              <span class="fw-semibold">Resultado da conversão:</span>
              <ng-container *ngIf="resultado; else semResultado">
                {{ resultado?.vl_resultado | number:'1.2-6' }}
              </ng-container>
              <ng-template #semResultado>—</ng-template>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-3">
        <div class="fw-semibold">Data cotação utilizada:</div>
        <div>
          {{ (dt_cotacao_usada || form.value.dt_referencia) | date:'dd/MM/yyyy' }}
        </div>
      </div>

      <div class="mt-2">
        <div class="fw-semibold">Taxa:</div>
        <div *ngIf="taxaDireta as t1; else semTaxa">
          1 {{ moedaOrigem?.no_moeda }}/{{ moedaOrigem?.co_moeda }} ({{ moedaOrigem?.nu_codigo_numerico }})
          = {{ t1 | number:'1.5-8' }}
          {{ moedaDestino?.no_moeda }}/{{ moedaDestino?.co_moeda }} ({{ moedaDestino?.nu_codigo_numerico }})
        </div>
        <div *ngIf="taxaInversa as t2">
          1 {{ moedaDestino?.no_moeda }}/{{ moedaDestino?.co_moeda }} ({{ moedaDestino?.nu_codigo_numerico }})
          = {{ t2 | number:'1.5-8' }}
          {{ moedaOrigem?.no_moeda }}/{{ moedaOrigem?.co_moeda }} ({{ moedaOrigem?.nu_codigo_numerico }})
        </div>
        <ng-template #semTaxa>—</ng-template>
      </div>

      <div class="alert alert-secondary mt-4 small mb-0">
        <ul class="mb-0 ps-3">
          <li>O cálculo é informativo e não substitui normas cambiais específicas.</li>
          <li>Datas disponíveis podem variar conforme a fonte das cotações.</li>
          <li>Para dias não úteis, pode ser utilizada a cotação do dia útil anterior.</li>
          <li>Não nos responsabilizamos por indisponibilidade de serviços de terceiros ou atrasos de atualização.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
